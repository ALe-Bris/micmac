MMv2Dir=..
INCLUDEDIRS = -I. -I${MMv2Dir}/include/
DOCDIR = doc/

MODULE_NAME = mmv2
I_SRCS = $(MODULE_NAME).i
PY_FILES = $(I_SRCS:.i=.py)
WRAP_CXX_FILES = $(I_SRCS:.i=_wrap.cxx)
WRAP_O_FILES = $(I_SRCS:.i=_wrap.o)

.PHONY: clean doc swig

apipy:
	swig -python -py3 -DFORSWIG -Wall -c++ ${INCLUDEDIRS} $(I_SRCS)
	rm -Rf dist/
	python3 setup.py bdist_wheel USEQT=$(USEQT)
	pip3 uninstall -y $(MODULE_NAME)
	pip3 install --user dist/*.whl
	#python3 setup.py install --user USEQT=$(USEQT)
	if python3 -c "import mmv2" ; then echo "APIPY OK" ; else echo "APIPY error! Use c++filt to demangle symbol." ; fi

all: apipy doc

doc:
	cd $(DOCDIR) && doxygen

clean:
	rm -f $(PY_FILES) $(WRAP_CXX_FILES) *.so *.o
	rm -Rf $(DOCDIR)/html build/ dist/ mmv2.egg-info/ __pycache__/ mmv2/
	python3 setup.py clean
	pip3 uninstall -y $(MODULE_NAME)

